<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>You‚Äôre Invited to My 7th Birthday!</title>
  <meta name="theme-color" content="#BBA5E3" />
  <style>
    :root{
      --ink:#1b1231; --muted:#6a6a7a; --card:#fff; --brand:#bba5e3; --shadow:0 14px 34px rgba(23,16,54,.12);
      --radius:24px;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0}
    body{
      color:var(--ink);
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      background:
        radial-gradient(1200px 600px at -10% -10%, #ffeaf3 0, #fff 60%),
        radial-gradient(900px 520px at 110% 0%, #e9f8ff 0, #fff 55%),
        linear-gradient(180deg,#fff, #f7f9ff);
      min-height:100vh;
    }
    .container{max-width:1000px;margin:0 auto;padding:18px 16px 110px; position:relative; z-index:1}
    .hero{
      background: linear-gradient(135deg, #ede7ff 0%, #d3fff3 100%);
      border-radius:28px;
      padding:26px 18px 20px;
      text-align:center;
      box-shadow:var(--shadow);
    }
    h1{margin:4px 0 4px; font-size:clamp(1.6rem, 3.5vw, 2.3rem); line-height:1.18;}
    #hiName{font-weight:800;opacity:.9;margin:0 0 8px}
    .tagline{margin:0 auto 10px; max-width:44ch; font-size:1.06rem; color:#2f2a44}
    .hero-photo-wrap{background:rgba(255,255,255,.8); border:1px solid rgba(255,255,255,.6);
      border-radius:20px; padding:10px; margin-top:12px; box-shadow:var(--shadow)}
    .hero-photo{width:100%; height:auto; display:block; border-radius:14px; object-fit:contain; background:#f5f7ff;}
    .details-grid{display:grid; grid-template-columns:1fr; gap:16px; margin-top:16px}
    @media (min-width:860px){ .details-grid{ grid-template-columns: 1.8fr .9fr; } }
    .section{background:var(--card); border-radius:var(--radius); padding:18px; box-shadow:var(--shadow)}
    .section h2{margin:0 0 12px; font-size:1.18rem}
    .kv{display:grid; grid-template-columns:120px 1fr; gap:10px; margin:8px 0; font-size:1.02rem}
    .kv .k{color:var(--muted)}
    .info-note{margin-top:14px; background:#fff5fb; border:1px solid #ffd6ec; border-radius:16px; padding:12px}
    .info-note li{margin:8px 0}
    .btns{display:flex; flex-wrap:wrap; gap:10px; margin-top:12px}
    .btn{
      appearance:none; border:none; cursor:pointer; background:linear-gradient(180deg,#fff,#f3f0ff);
      color:#2c2350; font-weight:800; border-radius:14px; padding:12px 16px; display:inline-flex; align-items:center; gap:10px;
      box-shadow:var(--shadow); text-decoration:none; transition: transform .08s ease;
    }
    .btn:active{ transform: translateY(1px) scale(.99) }
    .gif-card{ border-radius:22px; padding:12px; background:linear-gradient(180deg,#fff,#f9ffff); box-shadow:var(--shadow);
      display:flex; align-items:center; justify-content:center; }
    .gif{width:100%; height:auto; display:block; border-radius:16px;}
    .choices{display:grid; grid-template-columns:1fr; gap:12px; margin-top:8px}
    @media (min-width:720px){ .choices{ grid-template-columns:1fr 1fr; } }
    .choice{
      display:flex; align-items:center; justify-content:space-between; gap:12px; padding:16px; border-radius:16px;
      background:linear-gradient(180deg,#ffffff,#f7f7ff); border:1px solid #edeafc; box-shadow:var(--shadow); text-decoration:none; color:inherit;
      transition: transform .08s ease, box-shadow .15s ease;
    }
    .choice span{font-weight:800; font-size:1.04rem}
    .choice:hover{ transform: translateY(-1px); box-shadow:0 16px 36px rgba(23,16,54,.16) }
    .note{color:var(--muted)}
    textarea{ width:100%; min-height:96px; border:1px solid #e6e6f0; border-radius:14px; padding:12px; font-size:1rem;
      background:linear-gradient(180deg,#fff,#fbfbff); }
    .map{border-radius:18px; overflow:hidden; box-shadow:var(--shadow); margin-top:12px}
    #musicBtn {position:fixed;right:14px;bottom:14px;z-index:50;padding:10px 12px;border:0;border-radius:999px;font-weight:800;background:#fff;box-shadow:0 8px 22px rgba(0,0,0,.12);}
  </style>

<style id="chatgpt-rsvp-styles">
  .rsvp-option {
    display:inline-block;
    padding:12px 18px;
    margin:6px;
    border-radius:30px;
    font-size:1rem;
    font-weight:600;
    cursor:pointer;
    border:none;
    color:#fff;
    transition:background .2s, transform .1s;
  }
  .rsvp-option.selected { outline:3px solid #4442; }
  .rsvp-yes { background:#BBA5E3; }
  .rsvp-yes:hover { background:#a894d2; }
  .rsvp-no { background:#F7A8B8; }
  .rsvp-no:hover { background:#e799a9; }
  .rsvp-maybe { background:#A8D8F0; }
  .rsvp-maybe:hover { background:#94c9e6; }
  #submitRSVP {
    display:block;
    width:100%;
    margin-top:12px;
    padding:12px;
    border-radius:30px;
    background:#9C8ADE;
    border:none;
    color:#fff;
    font-size:1rem;
    font-weight:700;
    cursor:pointer;
  }
  #submitRSVP:hover { background:#8b79cc; }
  #ackMessage { margin-top:12px; font-weight:600; font-size:1rem; }
  #saveAllergy { background:#BBA5E3; color:#fff; border:none; border-radius:20px; padding:10px 14px; margin-top:8px; cursor:pointer; }
  #saveAllergy:hover { background:#a894d2; }
</style>

<style id="chatgpt-rsvp-theme">
/* === RSVP pastel theme & header/greeting tweaks === */
#hiName{ font-size:1.4rem !important; font-weight:800 !important; }
.hero h1, h1#title, header h1, h1 { margin-bottom: 1rem !important; }

.rsvp-wrap{ margin-top: 12px; }
.rsvp-options{ display:flex; gap:10px; flex-wrap:wrap; justify-content:center; }
.rsvp-btn{
  appearance:none; border:none; cursor:pointer;
  padding:12px 16px; border-radius:999px;
  font-weight:800; color:#fff;
  box-shadow:0 8px 20px rgba(0,0,0,.10);
  transition:transform .08s ease, filter .15s ease, box-shadow .15s ease;
}
.rsvp-btn:active{ transform:translateY(1px) scale(.99) }
.rsvp-btn:hover{ filter:brightness(.96); box-shadow:0 12px 26px rgba(0,0,0,.12); }
.rsvp-btn[data-choice="YES"]{ background:#BBA5E3; }   /* lilac */
.rsvp-btn[data-choice="NO"]{ background:#F7A8B8; }    /* blush pink */
.rsvp-btn[data-choice="MAYBE"]{ background:#A8D8F0; } /* baby blue */
.rsvp-btn.selected{ outline:3px solid rgba(0,0,0,.08); }

#submitRSVP{
  margin-top:12px; padding:12px 18px; border-radius:12px; border:none;
  background:#9C8ADE; color:#fff; font-weight:900; cursor:pointer;
  box-shadow:0 8px 22px rgba(0,0,0,.12);
}
#submitRSVP:hover{ filter:brightness(.96) }
#rsvpAck{ margin-top:10px; font-weight:700; text-align:center }
#saveAllergy{
  background:#9C8ADE !important; color:#fff !important; border:none !important;
  padding:10px 14px !important; border-radius:12px !important; font-weight:800 !important;
  box-shadow:0 6px 18px rgba(0,0,0,.10) !important;
}

</style>
</head>
<body>
  <div class="container">
    <!-- HERO -->
    <section class="hero" aria-labelledby="title">
      <h1 id="title">üéÇ You‚Äôre Invited to My 7th Birthday Party!</h1>
      <p id="hiName"></p>
      <p class="tagline">
        It‚Äôs my 7th birthday and I can‚Äôt wait to celebrate with you!
        Come play with me at the soft play, then stay for party food,
        birthday cake, and lots of fun, laughter, and memories to take home.
      </p>
      <div class="hero-photo-wrap">
        <img class="hero-photo" src="https://i.ibb.co/xtf6pZNb/cali.jpg" alt="Cali smiling" />
      </div>
    </section>

    <!-- Event details + GIF grid -->
    <section class="details-grid">
      <div class="section">
        <h2>Event Details</h2>
        <div class="kv"><div class="k">Date</div><div>Saturday, <strong>20 September 2025</strong></div></div>
        <div class="kv"><div class="k">Time</div><div><strong>14:00‚Äì15:00</strong> soft play, snacks & cake after</div></div>
        <div class="kv"><div class="k">Venue</div><div><strong>Swiss Cottage Leisure Centre</strong><br/>Adelaide Rd, London NW3 3NF</div></div>
        <div class="info-note">
          <ul>
            <li>üß∏ <strong>Drop-off party</strong>, but parents are very welcome to stay if they wish.</li>
            <li>üç∞ <strong>Snacks and birthday cake will be served</strong> ‚Äî please let us know about any <u>allergies</u> or dietary needs.</li>
          </ul>
        </div>
        <div class="btns">
          <button id="btnICS" class="btn" type="button">üì• Save to Calendar (.ics)</button>
          <a class="btn" target="_blank" rel="noopener" href="https://www.google.com/maps/dir/?api=1&destination=Swiss+Cottage+Leisure+Centre+NW3+3NF">üöó Start Google Navigation</a>
          <a class="btn" target="_blank" rel="noopener" href="http://maps.apple.com/?daddr=Swiss+Cottage%20Leisure%20Centre%20NW3%203NF">üöô Start Apple Navigation</a>
        </div>
        <div class="map">
          <iframe title="Map to Swiss Cottage Leisure Centre" src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d2483.611136410285!2d-0.1746041233010678!3d51.5441746109931!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x48761ac3141a5df9%3A0x85a06e1c1dc8d2d9!2sSwiss%20Cottage%20Leisure%20Centre!5e0!3m2!1sen!2suk!4v1726222337687!5m2!1sen!2suk" width="100%" height="290" style="border:0" allowfullscreen loading="lazy"></iframe>
        </div>
      </div>

      <aside class="gif-card" aria-label="Party vibe">
        <img class="gif" src="https://media.giphy.com/media/o0JqY89wfQUU/giphy.gif" alt="Cinnamoroll celebrating" />
      </aside>
    </section>

    <!-- RSVP -->
    <section class="section" aria-labelledby="rsvp-heading">
      <h2 id="rsvp-heading">RSVP</h2>
      <p class="note">Tap one ‚Äî we‚Äôll pre‚Äëfill your message. Or add <em>allergies/dietary</em> below and hit Save üíú</p>
      <div class="choices">
        <a class="choice" id="yesBtn" href="#"><span>üéâ We‚Äôre in!</span><small>Can‚Äôt wait to play</small></a>
        <a class="choice" id="noBtn" href="#"><span>üíå Sorry, we can‚Äôt make it</span><small>Sending birthday hugs</small></a>
        <a class="choice" id="lateBtn" href="#"><span>‚è∞ We might be late</span><small>Travel / nap schedule</small></a>
        <a class="choice" id="maybeBtn" href="#"><span>ü§û Maybe ‚Äî will confirm</span><small>Checking diaries</small></a>
        <a class="choice" id="questionBtn" href="#"><span>‚ùì I have a quick question</span><small>Food / siblings / parking</small></a>
      </div>

      <div class="section" style="margin-top:12px;padding:12px">
        <label for="allergyField" style="display:block;font-weight:700;margin-bottom:6px">Allergies / dietary notes</label>
        <textarea id="allergyField" placeholder="e.g., nut‚Äëfree, vegetarian, halal"></textarea>
        <button id="saveAllergy" class="btn" type="button" style="margin-top:10px">üíæ Save allergies</button>
        <p id="savedNote" class="note" style="display:none;margin-top:8px">Saved ‚Äî thank you!</p>
      </div>
    </section>

    <section class="section">
      <p class="note" style="text-align:center">‚ÄúCan‚Äôt wait to celebrate with you!‚Äù</p>
    </section>
  </div>

  <!-- Hidden YouTube player + music toggle -->
  <div id="yt-holder" style="position:fixed;left:-9999px;top:-9999px;width:1px;height:1px;overflow:hidden;"></div>
  <button id="musicBtn">üéµ sound on</button>

  <!-- YouTube API (non-module so onYouTubeIframeAPIReady is global) -->
  <script src="https://www.youtube.com/iframe_api"></script>

  <!-- Firebase + Firestore logging -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDtC4RvoYxotfxDyp32gjeFediehdaWrLs",
      authDomain: "cali-s-birthday.firebaseapp.com",
      projectId: "cali-s-birthday",
      storageBucket: "cali-s-birthday.firebasestorage.app",
      messagingSenderId: "68111770262",
      appId: "1:68111770262:web:fe550fad91db7d409bd8b7",
      measurementId: "G-50S5Y76DMQ"
    };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const qs = new URLSearchParams(location.search);
    const toName = (qs.get("to") || "").trim();
    const kids = (qs.get("kids") || "").trim();
    const adults = (qs.get("adults") || "").trim();
    const contactPrefill = (qs.get("contact") || "").trim();
    const allergiesPrefill = (qs.get("allergy") || "").trim();

    // Greet by name
    if (toName) {
      const el = document.getElementById("hiName");
      if (el) el.textContent = `Hi ${toName}!`;
    }

    // Log view
    try {
      await addDoc(collection(db, "views"), {
        to: toName || null, kids: kids || null, adults: adults || null,
        contact: contactPrefill || null, allergy: allergiesPrefill || null,
        ts: serverTimestamp(), referrer: document.referrer || null, ua: navigator.userAgent
      });
    } catch (e) { console.error("View log error:", e); }

    // Save allergies
    const allergyField = document.getElementById("allergyField");
    if (allergiesPrefill) allergyField.value = allergiesPrefill;
    document.getElementById("saveAllergy").addEventListener("click", async ()=>{
      const text = allergyField.value.trim();
      try{
        await addDoc(collection(db, "allergies"), {
          to: toName || null, kids: kids || null, adults: adults || null,
          allergy: text || null, contact: contactPrefill || null, ts: serverTimestamp()
        });
        const n = document.getElementById("savedNote");
        n.style.display = "block"; setTimeout(()=> n.style.display="none", 2500);
      }catch(e){ alert("Could not save right now. Please try again."); }
    });

    // RSVP logging helper exposed globally
    async function logRSVP(choice) {
      try {
        await addDoc(collection(db, "rsvps"), {
          to: toName || null, kids: kids || null, adults: adults || null, contact: contactPrefill || null,
          allergy: (allergyField.value.trim() || allergiesPrefill || null), choice, ts: serverTimestamp()
        });
      } catch (e) { console.error("RSVP log error:", e); }
    }
    window.__logRSVP = logRSVP;
  </script>

  <!-- Non-module JS for calendar + email + music + RSVP wiring -->
  <script>
    const eventTitle   = "Cali‚Äôs 7th Birthday Soft Play Party";
    const hostEmail    = "youremail@example.com"; // TODO: replace with your real email
    const eventWhere   = "Swiss Cottage Leisure Centre, Adelaide Rd, London NW3 3NF";
    const eventStart   = new Date(Date.UTC(2025, 8, 20, 13, 0));
    const eventEnd     = new Date(Date.UTC(2025, 8, 20, 14, 0));
    const eventDetails = "14:00‚Äì15:00 soft play, then snacks & cake. Socks required. Siblings welcome.";

    function pad(n){return n.toString().padStart(2,"0")}
    function toICSDate(d){ return d.getUTCFullYear()+pad(d.getUTCMonth()+1)+pad(d.getUTCDate())+"T"+pad(d.getUTCHours())+pad(d.getUTCMinutes())+"00Z"; }
    document.getElementById("btnICS").addEventListener("click", ()=>{
      const uid = (crypto.randomUUID ? crypto.randomUUID() : String(Date.now()));
      const ics = `BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//Cali7//Birthday//EN
CALSCALE:GREGORIAN
METHOD:PUBLISH
BEGIN:VEVENT
UID:${uid}
DTSTAMP:${toICSDate(new Date())}
DTSTART:${toICSDate(eventStart)}
DTEND:${toICSDate(eventEnd)}
SUMMARY:${eventTitle}
LOCATION:${eventWhere}
DESCRIPTION:${eventDetails}
END:VEVENT
END:VCALENDAR`;
      const blob = new Blob([ics], {type:"text/calendar"});
      const a = document.createElement("a"); a.href = URL.createObjectURL(blob); a.download = "cali-birthday-2025.ics"; a.click();
    });

    // mailto prefill + logging
    function openMail(subject, body){
      const mailto = `mailto:${encodeURIComponent(hostEmail)}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
      window.location.href = mailto;
    }
    function baseBody(extra){
      const qs = new URLSearchParams(location.search);
      const toName = (qs.get("to") || "").trim();
      const kids = (qs.get("kids") || "").trim();
      const adults = (qs.get("adults") || "").trim();
      const contactPrefill = (qs.get("contact") || "").trim();
      const allergyCurrent = (qs.get("allergy") || document.getElementById("allergyField").value.trim() || "(please list here)");

      return `Invitee: ${toName || "-"}
Children: ${kids || "-"}
Adults: ${adults || "-"}
Allergies/Dietary: ${allergyCurrent}
Contact: ${contactPrefill || "-"}

Choice: ${extra}

Event: ${eventTitle}
When: Sat 20 Sep 2025, 14:00‚Äì15:00
Where: ${eventWhere}`;
    }
    function wireButton(id, subjectLabel, choiceText){
      document.getElementById(id).addEventListener("click", async (e)=>{
        e.preventDefault();
        try { if (window.__logRSVP) await window.__logRSVP(subjectLabel); } catch(e){}
        openMail(`RSVP: ${eventTitle} ‚Äî ${subjectLabel}`, baseBody(choiceText));
      });
    }
    wireButton("yesBtn", "YES", "We're in! üéâ Can't wait to play.");
    wireButton("noBtn", "NO", "So sorry, we can't make it this time üíå We‚Äôll celebrate another day!");
    wireButton("lateBtn", "RUNNING LATE", "We might be a little late ‚è∞");
    wireButton("maybeBtn", "MAYBE", "Maybe ‚Äî just checking diaries ü§û");
    wireButton("questionBtn", "QUESTION", "Quick question about food/siblings/parking ‚ùì");

    // --- Background music (YouTube) ---
    let player, unmuted = false;
    function onYouTubeIframeAPIReady() {
      player = new YT.Player('yt-holder', {
        height: '1', width: '1',
        videoId: 'RE1faU5OVs4',
        playerVars: {
          autoplay: 1, loop: 1, playlist: 'RE1faU5OVs4',
          controls: 0, disablekb: 1, fs: 0, modestbranding: 1,
          playsinline: 1, rel: 0, iv_load_policy: 3
        },
        events: { 'onReady': onYTReady }
      });
    }
    function onYTReady(){
      try { player.mute(); player.playVideo(); } catch(e){}
      const resume = () => {
        if (unmuted) return;
        unmuted = true;
        try { player.unMute(); fadeVolume(0, 70, 500); } catch(e){}
        musicBtn.textContent = 'üîá mute';
        window.removeEventListener('pointerdown', resume, {once:true});
        window.removeEventListener('touchstart', resume, {once:true});
        window.removeEventListener('scroll', resume, {once:true});
      };
      window.addEventListener('pointerdown', resume, { once:true, passive:true });
      window.addEventListener('touchstart', resume, { once:true, passive:true });
      window.addEventListener('scroll', resume, { once:true, passive:true });
    }
    function fadeVolume(from, to, ms){
      if (!player || typeof player.setVolume !== 'function') return;
      const steps = 12, dt = ms/steps, dv = (to-from)/steps;
      let v = from; player.setVolume(v);
      const t = setInterval(()=>{
        v += dv; player.setVolume(Math.max(0, Math.min(100, v)));
        if ((dv>0 && v>=to) || (dv<0 && v<=to)) clearInterval(t);
      }, dt);
    }
    const musicBtn = document.getElementById('musicBtn');
    musicBtn.addEventListener('click', () => {
      if (!player) return;
      if (player.isMuted() || player.getVolume() === 0) {
        try { player.unMute(); fadeVolume(0, 70, 300); } catch(e){}
        musicBtn.textContent = 'üîá mute';
      } else {
        fadeVolume(player.getVolume(), 0, 200);
        setTimeout(()=>player.mute(), 220);
        musicBtn.textContent = 'üéµ sound on';
      }
    });
  </script>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDtC4RvoYxotfxDyp32gjeFediehdaWrLs",
    authDomain: "cali-s-birthday.firebaseapp.com",
    projectId: "cali-s-birthday",
    storageBucket: "cali-s-birthday.firebasestorage.app",
    messagingSenderId: "68111770262",
    appId: "1:68111770262:web:fe550fad91db7d409bd8b7",
    measurementId: "G-50S5Y76DMQ"
  };
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const qs = new URLSearchParams(location.search);
  const toName = (qs.get("to") || "Guest").trim();

  let selectedChoice = null;
  document.querySelectorAll(".rsvp-option").forEach(btn => {
    btn.addEventListener("click", () => {
      document.querySelectorAll(".rsvp-option").forEach(b=>b.classList.remove("selected"));
      btn.classList.add("selected");
      selectedChoice = btn.dataset.choice;
    });
  });

  document.getElementById("submitRSVP").addEventListener("click", async()=>{
    if(!selectedChoice){
      alert("Please select an option first.");
      return;
    }
    await addDoc(collection(db,"rsvps"),{to:toName, choice:selectedChoice, ts:serverTimestamp()});
    const ack = document.getElementById("ackMessage");
    if(selectedChoice.includes("Yes")) ack.textContent = `Yay! We can‚Äôt wait to see you, ${toName}! üéâ`;
    else if(selectedChoice.includes("Sorry")) ack.textContent = `Sorry you can‚Äôt make it, ${toName}. We‚Äôll miss you! üò¢`;
    else ack.textContent = `Got it, ${toName} ‚Äî let us know if you decide! ü§î`;
  });

  document.getElementById("saveAllergy").addEventListener("click", async()=>{
    const val = document.getElementById("allergyField").value;
    if(!val){ alert("Please type something first."); return; }
    await addDoc(collection(db,"allergies"),{to:toName, allergy:val, ts:serverTimestamp()});
    document.getElementById("savedNote").style.display="block";
  });
</script>


<script>
(function(){
  // Try to find the RSVP section container
  const rsvpHeading = document.querySelector('#rsvp-heading') || document.querySelector('h2#rsvp-heading') || [...document.querySelectorAll('h2')].find(h=>/rsvp/i.test(h.textContent));
  let container = null;
  if (rsvpHeading) {
    // Use the next .choices container if present, otherwise create our own wrap after heading
    container = rsvpHeading.parentElement;
  } else {
    // fallback: use body end
    container = document.body;
  }

  // Remove any existing mailto wiring by nuking old .choices content
  const oldChoices = container.querySelector('.choices');
  if (oldChoices) {
    oldChoices.innerHTML = '';
  }

  // Build our RSVP UI
  const wrap = document.createElement('div');
  wrap.className = 'rsvp-wrap';
  wrap.innerHTML = `
    <div class="rsvp-options" role="group" aria-label="RSVP options">
      <button class="rsvp-btn" data-choice="YES">üéâ Yes, I‚Äôll be there!</button>
      <button class="rsvp-btn" data-choice="NO">üò¢ Sorry, I can‚Äôt make it</button>
      <button class="rsvp-btn" data-choice="MAYBE">ü§î Maybe ‚Äî will confirm</button>
    </div>
    <div style="display:flex;justify-content:center">
      <button id="submitRSVP" type="button">Submit RSVP</button>
    </div>
    <div id="rsvpAck" aria-live="polite"></div>
  `;

  // If we had a .choices container, append after it; otherwise append to container
  if (oldChoices) {
    oldChoices.after(wrap);
  } else {
    container.appendChild(wrap);
  }

  // Selection logic
  let selected = null;
  wrap.querySelectorAll('.rsvp-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      wrap.querySelectorAll('.rsvp-btn').forEach(b => b.classList.remove('selected'));
      btn.classList.add('selected');
      selected = btn.getAttribute('data-choice');
    }, {passive:true});
  });

  // Submit logic
  const ack = wrap.querySelector('#rsvpAck');
  const submit = wrap.querySelector('#submitRSVP');
  submit.addEventListener('click', async () => {
    if (!selected) {
      ack.textContent = 'Please pick an option first üôÇ';
      return;
    }
    // Persist to Firestore - reuse existing __logRSVP if available
    try {
      if (window.__logRSVP) {
        await window.__logRSVP(selected);
      }
    } catch(e) { console.error(e); }

    // Friendly acknowledgements
    const qs = new URLSearchParams(location.search);
    const name = (qs.get('to') || 'there').trim();
    if (selected === 'YES') {
      ack.textContent = `üéâ Yay! We can‚Äôt wait to see you, ${name}!`;
    } else if (selected === 'NO') {
      ack.textContent = `üíå Thanks for letting us know, ${name}. We‚Äôll miss you!`;
    } else {
      ack.textContent = `ü§ó No worries, ${name} ‚Äî just let us know when you can!`;
    }
  });
})();
</script>

</body>
</html>
